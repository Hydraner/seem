<?php

/**
 * @file
 * Contains hook implementations and functions for the seem module.
 */
use Drupal\layout_plugin\Layout;

/**
 * Implements hook_entity_view_alter().
 */
function seem_entity_view_alter(array &$build, Drupal\Core\Entity\EntityInterface $entity, \Drupal\Core\Entity\Display\EntityViewDisplayInterface $display) {
  $build['#theme_wrappers'][] = 'seem_wrapper';
}

/**
 * Implements hook_theme().
 */
function seem_theme($existing, $type, $theme, $path) {
  return array(
    'seem_wrapper' => array(
      'render element' => 'content',
      'template' => 'layout/seem-wrapper',
      'children' => array(),
    ),
    'layout' => array(
      'render element' => 'region',
      'template' => 'layout/layout',
      'regions' => array(),
    ),
  );
}

/**
 * Implementation of template_preprocess_seem_wrapper().
 */
function seem_preprocess_seem_wrapper(&$variables) {
//  $layout_plugin_manager = Layout::layoutPluginManager();
//  $debug = 1;

  if (isset($variables['content']['#node'])) {
    $debug = 1;
    $context = $variables['content'];
    $variables['content'] = array();
    $variables['content']['region_1']['#theme_wrappers'][] = 'region';
    $variables['content']['region_1']['#region'] = 'region_1';
    $variables['content']['region_1']['random'] = $context;

    $variables['content']['sidebar']['#theme_wrappers'][] = 'region';
    $variables['content']['sidebar']['#region'] = 'sidebar';
    $variables['content']['sidebar']['random']['#markup'] = 'Ich bin eine Sidebar';
  }
  else {
    $variables['content'] = $variables['content']['#children'];
  }
}
