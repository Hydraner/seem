<?php

/**
 * @file
 * Contains hook implementations and functions for the seem module.
 */

/**
 * Implements hook_entity_view_alter().
 */
function seem_entity_view_alter(array &$build, Drupal\Core\Entity\EntityInterface $entity, \Drupal\Core\Entity\Display\EntityViewDisplayInterface $display) {
  if (!isset($build['#rendered'])) {
    $context = $build;
    $build = array(
      'content' => array(
        '#type' => 'seem',
        '#element_type' => 'entity',
        '#context' => $context,
        '#entity_type' => $entity->getEntityTypeId(),
        '#bundle' => $display->getTargetBundle(),
        '#view_mode' => $display->getMode()
      )
    );
  }
}

/**
 * Implements hook_entity_view_alter().
 */
function seem_form_alter(&$form, $form_state) {
  $form['#post_render'][] = 'seem_post_render';
}

function seem_post_render($markup, $element) {
  if (!isset($element['#rendered'])) {
    $output = array(
      'content' => array(
        '#type' => 'seem',
        '#element_type' => 'form',
        '#context' => array('#markup' => $markup)
      )
    );
    // @todo: Find a better solution for that.
    return \Drupal::service('renderer')->render($output, FALSE);
  }
}

